{"version":3,"sources":["../src/mode-clickhouse.js"],"names":["ace","define","require","exports","module","oop","TextHighlightRules","ClickhouseInfo","ClickHouseHighlightRules","keywords","KeywordsRe","builtinConstants","ConstantsRe","builtinFunctions","FunctionsRe","dataTypes","DataTypesRe","keywordMapper","createKeywordMapper","$rules","token","regex","start","end","normalizeRules","inherits","lang","keyWordsCompletions","Keywords","map","word","caption","value","meta","score","Number","MAX_VALUE","constantCompletions","Constants","macrosCompletions","MacrosCompletions","item","name","docHTML","convertToHTML","functionsCompletions","FunctionsCompletions","wrapText","str","len","lines","space_index","line_start","next_line_end","line","i","length","slice","push","join","convertMarkDownTags","text","replace","docText","escapeHTML","def","ClickhouseCompletions","getCompletions","state","session","pos","prefix","callback","completions","concat","call","prototype","TextMode","Mode","HighlightRules","$completer","completer","$id"],"mappings":"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","file":"mode-clickhouse.js","sourcesContent":["// jshint ignore: start\r\n// jscs: disable\r\n\r\nace.define(\"ace/mode/clickhouse_highlight_rules\", [\"require\", \"exports\", \"module\", \"ace/lib/oop\", \"ace/mode/text_highlight_rules\"], function (require, exports, module) {\r\n    \"use strict\";\r\n\r\n    var oop = require(\"../lib/oop\");\r\n    var TextHighlightRules = require(\"./text_highlight_rules\").TextHighlightRules;\r\n    var ClickhouseInfo = require(\"./clickhouse_info\").ClickhouseInfo;\r\n\r\n    var ClickHouseHighlightRules = function () {\r\n        var keywords = ClickhouseInfo.KeywordsRe(),\r\n            builtinConstants = ClickhouseInfo.ConstantsRe(),\r\n            builtinFunctions = ClickhouseInfo.FunctionsRe(),\r\n            dataTypes = ClickhouseInfo.DataTypesRe();\r\n\r\n        var keywordMapper = this.createKeywordMapper({\r\n            \"support.function\": builtinFunctions,\r\n            \"keyword\": keywords,\r\n            \"constant.language\": builtinConstants,\r\n            \"storage.type\": dataTypes\r\n        }, \"identifier\", true);\r\n\r\n        this.$rules = {\r\n            \"start\": [{\r\n                token: \"comment\",\r\n                regex: \"--.*$\"\r\n            }, {\r\n                token: \"comment.block\",\r\n                start: \"```\",\r\n                end: \"```\"\r\n            }, {\r\n                token: \"string\",           // ' string\r\n                regex: \"'.*?'\"\r\n            }, {\r\n                token: \"variable\",\r\n                regex: \"\\\\$\\\\w+\"\r\n            }, {\r\n                token: \"keyword.operator\",\r\n                regex: \"\\\\+|\\\\-|\\\\/|\\\\/\\\\/|%|<@>|@>|<@|&|\\\\^|~|<|>|<=|=>|==|!=|<>|=|\\\\?|:\"\r\n            }, {\r\n                token: \"constant.numeric\", // float\r\n                regex: \"[+-]?\\\\d+(?:(?:\\\\.\\\\d*)?(?:[eE][+-]?\\\\d+)?)?\\\\b\"\r\n            }, {\r\n                token: keywordMapper,\r\n                regex: \"[a-zA-Z_$][a-zA-Z0-9_$]*\\\\b\"\r\n            }, {\r\n                token: \"paren.lparen\",\r\n                regex: \"[\\\\(]\"\r\n            }, {\r\n                token: \"paren.rparen\",\r\n                regex: \"[\\\\)]\"\r\n            }, {\r\n                token: \"text\",\r\n                regex: \"\\\\s+\"\r\n            }]\r\n        };\r\n        this.normalizeRules();\r\n    };\r\n\r\n    oop.inherits(ClickHouseHighlightRules, TextHighlightRules);\r\n\r\n    exports.ClickHouseHighlightRules = ClickHouseHighlightRules;\r\n});\r\n\r\nace.define(\"ace/mode/clickhouse_completions\", [\"require\", \"exports\", \"module\", \"ace/token_iterator\", \"ace/lib/lang\"], function (require, exports, module) {\r\n    \"use strict\";\r\n\r\n    var lang = require(\"../lib/lang\"),\r\n        ClickhouseInfo = require(\"./clickhouse_info\").ClickhouseInfo;\r\n\r\n    var keyWordsCompletions = ClickhouseInfo.Keywords.map(function (word) {\r\n        return {\r\n            caption: word,\r\n            value: word,\r\n            meta: \"keyword\",\r\n            score: Number.MAX_VALUE\r\n        }\r\n    });\r\n\r\n    var constantCompletions = ClickhouseInfo.Constants.map(function (word) {\r\n        return {\r\n            caption: word,\r\n            value: word,\r\n            meta: \"constant\",\r\n            score: Number.MAX_VALUE\r\n        };\r\n    });\r\n\r\n    var macrosCompletions = ClickhouseInfo.MacrosCompletions().map(function (item) {\r\n        return {\r\n            caption: item.name,\r\n            value: item.name,\r\n            docHTML: convertToHTML(item),\r\n            meta: \"macros\",\r\n            score: Number.MAX_VALUE\r\n        };\r\n    });\r\n\r\n\r\n    var functionsCompletions = ClickhouseInfo.FunctionsCompletions().map(function (item) {\r\n        return {\r\n            caption: item.name,\r\n            value: item.name+\"()\",\r\n            docHTML: convertToHTML(item),\r\n            meta: \"function\",\r\n            score: Number.MAX_VALUE\r\n        };\r\n    });\r\n\r\n    function wrapText(str, len) {\r\n        len = len || 90;\r\n        var lines = [];\r\n        var space_index = 0;\r\n        var line_start = 0;\r\n        var next_line_end = len;\r\n        var line = \"\";\r\n        for (var i = 0; i < str.length; i++) {\r\n            if (str[i] === ' ') {\r\n                space_index = i;\r\n            } else if (i >= next_line_end  && space_index !== 0) {\r\n                line = str.slice(line_start, space_index);\r\n                lines.push(line);\r\n                line_start = space_index + 1;\r\n                next_line_end = i + len;\r\n                space_index = 0;\r\n            }\r\n        }\r\n        line = str.slice(line_start);\r\n        lines.push(line);\r\n        return lines.join(\"&nbsp<br>\");\r\n    }\r\n\r\n    function convertMarkDownTags(text) {\r\n        text = text.replace(/```(.+)```/, \"<pre>$1</pre>\");\r\n        text = text.replace(/`([^`]+)`/, \"<code>$1</code>\");\r\n        return text;\r\n    }\r\n\r\n    function convertToHTML(item) {\r\n        var docText = lang.escapeHTML(item.docText);\r\n        docText = convertMarkDownTags(wrapText(docText, 90));\r\n        return [\r\n            \"<b>\", lang.escapeHTML(item.def), \"</b>\", \"<hr></hr>\", docText, \"<br>&nbsp\"\r\n        ].join(\"\");\r\n    }\r\n\r\n    var ClickhouseCompletions = function () {\r\n    };\r\n\r\n    (function () {\r\n        this.getCompletions = function (state, session, pos, prefix, callback) {\r\n            var completions = keyWordsCompletions.concat(functionsCompletions).concat(constantCompletions);\r\n            completions = completions.concat(macrosCompletions);\r\n            callback(null, completions);\r\n        };\r\n\r\n    }).call(ClickhouseCompletions.prototype);\r\n\r\n    exports.ClickhouseCompletions = ClickhouseCompletions;\r\n});\r\n\r\n\r\nace.define(\"ace/mode/clickhouse\", [\"require\", \"exports\", \"module\", \"ace/lib/oop\", \"ace/mode/text\", \"ace/mode/clickhouse_highlight_rules\"], function (require, exports, module) {\r\n    \"use strict\";\r\n\r\n    var oop = require(\"../lib/oop\");\r\n    var TextMode = require(\"./text\").Mode;\r\n    var ClickHouseHighlightRules = require(\"./clickhouse_highlight_rules\").ClickHouseHighlightRules;\r\n    var ClickhouseCompletions = require(\"./clickhouse_completions\").ClickhouseCompletions;\r\n\r\n\r\n    var Mode = function () {\r\n        this.HighlightRules = ClickHouseHighlightRules;\r\n        this.$completer = new ClickhouseCompletions();\r\n        // replace keyWordCompleter\r\n        this.completer = this.$completer;\r\n    };\r\n\r\n    oop.inherits(Mode, TextMode);\r\n\r\n    (function () {\r\n        this.$id = \"ace/mode/clickhouse\";\r\n    }).call(Mode.prototype);\r\n\r\n    exports.Mode = Mode;\r\n});\r\n\r\n"]}