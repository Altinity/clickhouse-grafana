$perSecondColumnsAggregated(key, value, fun1, val1, fun2, val2) from table_name
SELECT t, key, fun1(val1PerSecond) AS val1PerSecondAgg, fun2(val2PerSecond) AS val2PerSecondAgg FROM (  SELECT t, key, value, if(runningDifference(val1) < 0 OR neighbor(value,-1,value) != value, nan, runningDifference(val1) / runningDifference(t / 1000)) AS val1PerSecond, if(runningDifference(val2) < 0 OR neighbor(value,-1,value) != value, nan, runningDifference(val2) / runningDifference(t / 1000)) AS val2PerSecond  FROM (   SELECT (intDiv(toUInt32(""), 30) * 30) * 1000 AS t, key, value, max(val1) AS val1, max(val2) AS val2   from table_name WHERE
